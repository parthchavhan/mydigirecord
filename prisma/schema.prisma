generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model companies {
  id        String     @id
  name      String
  createdAt DateTime   @default(now())
  updatedAt DateTime
  folders   folders[]
  payments  payments[]
  users     users[]
  auditLogs auditLogs[]
}

model files {
  id           String    @id
  name         String
  folderId     String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  size         Float     @default(1048576)
  userId       String?
  category     String?
  expiryDate   DateTime?
  issueDate    DateTime?
  key          String?
  mimeType     String?
  placeOfIssue String?
  renewalDate  DateTime?
  url          String?
  deletedAt    DateTime?
  folders      folders   @relation(fields: [folderId], references: [id], onDelete: Cascade)
  users        users?    @relation(fields: [userId], references: [id])
}

model folders {
  id            String    @id
  name          String
  companyId     String
  parentId      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  userId        String?
  deletedAt     DateTime?
  isLocked      Boolean   @default(false)
  password      String?
  files         files[]
  companies     companies @relation(fields: [companyId], references: [id], onDelete: Cascade)
  folders       folders?  @relation("foldersTofolders", fields: [parentId], references: [id], onDelete: Cascade)
  other_folders folders[] @relation("foldersTofolders")
  users         users?    @relation(fields: [userId], references: [id])
}

model payments {
  id          String    @id
  amount      Float
  companyId   String
  userId      String?
  status      String    @default("pending")
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  companies   companies @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users       users?    @relation(fields: [userId], references: [id])
}

model users {
  id        String     @id
  email     String
  password  String
  name      String
  companyId String
  role      String     @default("employee") // super_admin, admin, employee
  createdAt DateTime   @default(now())
  updatedAt DateTime
  files     files[]
  folders   folders[]
  payments  payments[]
  companies companies  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  auditLogs auditLogs[]

  @@unique([email, companyId])
}

model auditLogs {
  id          String    @id
  action      String    // create, delete, update, move, copy, share
  entityType  String    // file, folder
  entityId    String
  entityName  String
  userId      String?
  companyId   String
  details     String?   // JSON string for additional details
  createdAt   DateTime  @default(now())
  users       users?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  companies   companies @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([userId])
  @@index([createdAt])
}
